
define(['jquery','quiz_teacheroverview/d3','quiz_teacheroverview/nvd3amd','core/str'],function($,d3,nvd3amd,str){return{init:function(block3j,block4j){$("#filtervalue").click(resetFilter);function resetFilter(){$('#attempts tbody tr').not('.emptyrow').show();var allResults=str.get_string('all_results','quiz_teacheroverview');allResults.done(function(val){$("#filtervalue").removeClass('filtered').html(val)});window.lastindex=-1;}
nv.addGraph(function(){var chart3=nv.models.discreteBarChart().x(function(d){return d.label;}).y(function(d){return d.value;}).staggerLabels(false).showValues(false).duration(250).showLegend(false);chart3.color(['#8F6FC2','#7f3e53','#260A55','#260A55','#260A55','#260A55','#260A55']);chart3.showYAxis(false);chart3.yAxis.tickFormat(d3.format('d'));d3.select('#block3 svg').datum(JSON.parse(block3j)).call(chart3);nv.utils.windowResize(chart3.update);chart3.discretebar.dispatch.on('elementClick',function(e){var inProgressFilterStringPr=str.get_string('stateinprogress','quiz');var notStartedFilterStringPr=str.get_string('notstarted','quiz_teacheroverview');$.when(inProgressFilterStringPr,notStartedFilterStringPr).then(function(inProgressFilterString,notStartedFilterString){var range=e.data.label.split(' - ');var minrange=Math.min(...range);var maxrange=Math.max(...range);var searchParams=new URLSearchParams(window.location.search);var param=searchParams.get('display');var gradecell='td.teacheroverviewgrades';var statecell='td.teacheroverviewstate';if(window.lastindex===e.index){resetFilter();}else{$('#attempts tbody tr').not('.emptyrow').each(function(){var grade=$(this).find(gradecell).text();var state=$(this).find(statecell).text();$(this).show();$(this).toggle();if(parseInt(grade)>=minrange&&parseInt(grade)<maxrange){$(this).toggle();}
if((parseInt(maxrange)===10&&parseInt(grade)===10)||(parseInt(maxrange)===100&&parseInt(grade)===100)){$(this).toggle();}
if(e.index===0&&grade.includes('-')&&state.includes(inProgressFilterString)){$(this).toggle();}});window.lastindex=e.index;var filteredResults=str.get_string('filtered_results','quiz_teacheroverview',{'label':e.data.label,'value':e.data.value});filteredResults.done(function(val){$("#filtervalue").addClass('filtered').html(val)});$("HTML, BODY").animate({scrollTop:$("#attempts").offset().top},800);};});});return chart3;});nv.addGraph(function(){var chart4=nv.models.pieChart().x(function(d){return d.label;}).y(function(d){return d.value;}).showLegend(false).showLabels(false).labelThreshold(0.05).labelType('percent').donut(true).donutRatio(0.5).color(['#260A55','#8F6FC2','#A864A8']);chart4.valueFormat(d3.format('d'));d3.select('#block4 svg').datum(JSON.parse(block4j)).transition().duration(350).call(chart4);nv.utils.windowResize(chart4.update);chart4.pie.dispatch.on('elementClick',function(e){var inProgressFilterStringPr=str.get_string('stateinprogress','quiz');var notStartedFilterStringPr=str.get_string('notstarted','quiz_teacheroverview');$.when(inProgressFilterStringPr,notStartedFilterStringPr).then(function(inProgressFilterString,notStartedFilterString){var searchParams=new URLSearchParams(window.location.search);var param=searchParams.get('display')
var gradecell='td.teacheroverviewgrades';var statecell='td.teacheroverviewstate';if(window.lastindex===e.index){resetFilter();}else{$('#attempts tbody tr').not('.emptyrow').each(function(){var grade=$(this).find(gradecell).text();var state=$(this).find(statecell).text();$(this).show();$(this).toggle();if(e.index===0&&!grade.includes('-')){$(this).toggle();}
if(e.index===1&&grade.includes('-')&&state.includes(inProgressFilterString)){$(this).toggle();}
if(e.index===2&&grade.includes('-')&&state.includes(notStartedFilterString)){$(this).toggle();}})
window.lastindex=e.index;var filteredResults=str.get_string('filtered_results','quiz_teacheroverview',{'label':e.data.label,'value':e.data.value});filteredResults.done(function(val){$("#filtervalue").addClass('filtered').html(val)});$("HTML, BODY").animate({scrollTop:$("#attempts").offset().top},800);};});});return chart4;});$('.quiz_teacheroverview_dashboard_block2 .question_details-element').click(function(e){var searchParams=new URLSearchParams(window.location.search);var displayparam=searchParams.get('display');var gradecell='td.teacheroverviewqsgrade'+parseInt(e.target.innerHTML);if($(this).hasClass('green')){var qstatus=gradecell+' span.'+'user-correct';var qstatusstr='filtered_results_succeeded_by_questions';}else{var qstatus=gradecell+' span.'+'incorrect, '+gradecell+' span.'+'user-partiallycorrect, '+gradecell+' span.'+'notanswered';var qstatusstr='filtered_results_failed_by_questions';}
if(displayparam==='full'){$('#attempts tbody tr').not('.emptyrow').each(function(){var ca=$(this).find($(qstatus));$(this).show();$(this).toggle();if(ca.length>0){$(this).toggle();}});var filteredResults=str.get_string(qstatusstr,'quiz_teacheroverview',e.target.innerHTML);filteredResults.done(function(val){$("#filtervalue").addClass('filtered').html(val)});$("HTML, BODY").animate({scrollTop:$("#attempts").offset().top},800);}else{searchParams.set('display','full');searchParams.set('q',e.target.innerHTML);window.location.href=window.location.origin+window.location.pathname+'?'+searchParams.toString();}});var searchParams=new URLSearchParams(window.location.search);var qparam=searchParams.get('q');var displayparam=searchParams.get('display');if(qparam&&displayparam==='full'){var t=$('.quiz_teacheroverview_dashboard_block2 .question_details-element#dq'+qparam).trigger("click");}}};});